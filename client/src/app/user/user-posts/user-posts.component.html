<div class="feed" *ngIf="isUserPostsLoaded">

  <mat-card class="ig-post" *ngFor="let post of posts; let i = index">

    <!-- Фото -->
    <img class="ig-photo" [src]="post.image" alt="photo" />

    <!-- Экшен-строка -->
    <section class="actions">
      <div class="left">
        <button mat-icon-button (click)="toggleLike(post, i)">
          <mat-icon [ngClass]="{ liked: post.isLiked }">favorite</mat-icon>
        </button>
        <button mat-icon-button>
          <mat-icon>chat_bubble_outline</mat-icon>
        </button>
        <button mat-icon-button>
          <mat-icon>send</mat-icon>
        </button>
      </div>
      <button mat-icon-button>
        <mat-icon>bookmark_border</mat-icon>
      </button>
    </section>

    <!-- Лайки -->
    <section class="likes">
      <span>{{ post.likes }} like{{ post.likes === 1 ? '' : 's' }}</span>
    </section>

    <!-- Caption -->
    <section class="caption">
      <b>{{ post.username }}</b> {{ post.caption }}
    </section>

    <!-- Комментарии (показываем максимум 2, остальное сворачивается) -->
    <ng-container *ngIf="post.comments?.length">
      <button class="view-all" mat-button *ngIf="post.comments!.length > 2"
              (click)="post.showAllComments = !post.showAllComments">
        View {{ post.showAllComments ? 'less' : 'all' }} {{ post.comments!.length }} comments
      </button>

      <div class="comment"
           *ngFor="let c of (post.showAllComments ? post.comments : post.comments | slice:0:2); let ci = index">
        <b>{{ c.username }}</b> {{ c.message }}
        <button mat-icon-button (click)="deleteComment(c.id!, i, ci)">
          <mat-icon>clear</mat-icon>
        </button>
      </div>
    </ng-container>

    <!-- Дата -->
    <time class="timestamp">{{ post.createdAt | date:'mediumDate' }}</time>
  </mat-card>
</div>
