<div class="feed" *ngIf="isUserPostsLoaded">

  <mat-card class="ig-post" *ngFor="let post of posts; let i = index">

    <!-- Фото -->
    <img class="ig-photo"
         [src]="post.image"
         alt="photo"
         (click)="openPostDetails(i)" style="cursor: pointer;"/>

  </mat-card>
  <!-- Модальное окно поста на весь экран -->
  <div class="fullscreen-modal"
       *ngIf="openedPostIndex !== null"
       (click)="closePostDetails()">
    <div class="fullscreen-content" (click)="$event.stopPropagation()">
      <div class="modal-img-block">
        <img class="modal-photo"
             [src]="posts[openedPostIndex!].image"
             alt="photo"/>
      </div>
      <div class="modal-info-block">
        <section class="actions">
          <div class="left">
            <button mat-icon-button (click)="toggleLike(posts[openedPostIndex!], openedPostIndex!)">
              <mat-icon [ngClass]="{ liked: posts[openedPostIndex!].isLiked }">favorite</mat-icon>
            </button>
            <button mat-icon-button>
              <mat-icon>chat_bubble_outline</mat-icon>
            </button>
            <button mat-icon-button>
              <mat-icon>send</mat-icon>
            </button>
          </div>
          <button mat-icon-button>
            <mat-icon>bookmark_border</mat-icon>
          </button>
        </section>
        <section class="likes">
          <span>{{ posts[openedPostIndex!].likes }} like{{ posts[openedPostIndex!].likes === 1 ? '' : 's' }}</span>
        </section>
        <section class="caption">
          <b>{{ posts[openedPostIndex!].username }}</b> {{ posts[openedPostIndex!].caption }}
        </section>
        <ng-container *ngIf="posts[openedPostIndex!].comments?.length">
          <button class="view-all" mat-button *ngIf="posts[openedPostIndex!].comments!.length > 2"
                  (click)="posts[openedPostIndex!].showAllComments = !posts[openedPostIndex!].showAllComments">
            View {{ posts[openedPostIndex!].showAllComments ? 'less' : 'all' }} {{ posts[openedPostIndex!].comments!.length }}
            comments
          </button>
          <div class="comment"
               *ngFor="let c of (posts[openedPostIndex!].showAllComments ? posts[openedPostIndex!].comments : posts[openedPostIndex!].comments | slice:0:2); let ci = index">
            <b>{{ c.username }}</b> {{ c.message }}
            <button mat-icon-button (click)="deleteComment(c.id!, openedPostIndex!, ci)">
              <mat-icon>clear</mat-icon>
            </button>
          </div>
        </ng-container>
        <time class="timestamp">{{ posts[openedPostIndex!].createdAt | date:'mediumDate' }}</time>
        <button mat-button (click)="closePostDetails()" style="width: 100%;margin-top: 16px;">Закрыть</button>
      </div>
    </div>
  </div>
</div>
